<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>mPulse Boomerang Tutorial: Non-Blocking Loader Snippet</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.akamai.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">mPulse Boomerang</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="BOOMR.html">BOOMR</a></li><li><a href="BOOMR.browser.html">BOOMR.browser</a></li><li><a href="BOOMR.constants.html">BOOMR.constants</a></li><li><a href="BOOMR.plugins.html">BOOMR.plugins</a></li><li><a href="BOOMR.plugins.Akamai.html">BOOMR.plugins.Akamai</a></li><li><a href="BOOMR.plugins.AutoXHR.html">BOOMR.plugins.AutoXHR</a></li><li><a href="BOOMR.plugins.BFCache.html">BOOMR.plugins.BFCache</a></li><li><a href="BOOMR.plugins.BW.html">BOOMR.plugins.BW</a></li><li><a href="BOOMR.plugins.CACHE_RELOAD.html">BOOMR.plugins.CACHE_RELOAD</a></li><li><a href="BOOMR.plugins.Clicks.html">BOOMR.plugins.Clicks</a></li><li><a href="BOOMR.plugins.ConfigOverride.html">BOOMR.plugins.ConfigOverride</a></li><li><a href="BOOMR.plugins.ConsentInlinedPlugin.html">BOOMR.plugins.ConsentInlinedPlugin</a></li><li><a href="BOOMR.plugins.Continuity.html">BOOMR.plugins.Continuity</a></li><li><a href="BOOMR.plugins.CrossDomain.html">BOOMR.plugins.CrossDomain</a></li><li><a href="BOOMR.plugins.CT.html">BOOMR.plugins.CT</a></li><li><a href="BOOMR.plugins.DNS.html">BOOMR.plugins.DNS</a></li><li><a href="BOOMR.plugins.Early.html">BOOMR.plugins.Early</a></li><li><a href="BOOMR.plugins.Errors.html">BOOMR.plugins.Errors</a></li><li><a href="BOOMR.plugins.EventTiming.html">BOOMR.plugins.EventTiming</a></li><li><a href="BOOMR.plugins.GUID.html">BOOMR.plugins.GUID</a></li><li><a href="BOOMR.plugins.History.html">BOOMR.plugins.History</a></li><li><a href="BOOMR.plugins.IFrameDelay.html">BOOMR.plugins.IFrameDelay</a></li><li><a href="BOOMR.plugins.IPv6.html">BOOMR.plugins.IPv6</a></li><li><a href="BOOMR.plugins.LOGN.html">BOOMR.plugins.LOGN</a></li><li><a href="BOOMR.plugins.Memory.html">BOOMR.plugins.Memory</a></li><li><a href="BOOMR.plugins.Mobile.html">BOOMR.plugins.Mobile</a></li><li><a href="BOOMR.plugins.NavigationTiming.html">BOOMR.plugins.NavigationTiming</a></li><li><a href="BOOMR.plugins.PageParams.html">BOOMR.plugins.PageParams</a></li><li><a href="BOOMR.plugins.PaintTiming.html">BOOMR.plugins.PaintTiming</a></li><li><a href="BOOMR.plugins.ResourceTiming.html">BOOMR.plugins.ResourceTiming</a></li><li><a href="BOOMR.plugins.RT.html">BOOMR.plugins.RT</a></li><li><a href="BOOMR.plugins.SPA.html">BOOMR.plugins.SPA</a></li><li><a href="BOOMR.plugins.TPAnalytics.html">BOOMR.plugins.TPAnalytics</a></li><li><a href="BOOMR.plugins.UserTiming.html">BOOMR.plugins.UserTiming</a></li><li><a href="BOOMR.session.html">BOOMR.session</a></li><li><a href="BOOMR.utils.html">BOOMR.utils</a></li><li><a href="BOOMR.utils.Compression.html">BOOMR.utils.Compression</a></li><li><a href="BOOMR_mq.html">BOOMR_mq</a></li><li><a href="MutationHandler.html">MutationHandler</a></li><li><a href="ProxyXHRImplementation.html">ProxyXHRImplementation</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="events.list.html" class="dropdown-toggle" data-toggle="dropdown">Events<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="BOOMR.html#event:beacon">BOOMR#event:beacon</a></li><li><a href="BOOMR.html#event:before_beacon">BOOMR#event:before_beacon</a></li><li><a href="BOOMR.html#event:before_early_beacon">BOOMR#event:before_early_beacon</a></li><li><a href="BOOMR.html#event:before_unload">BOOMR#event:before_unload</a></li><li><a href="BOOMR.html#event:bfcache">BOOMR#event:bfcache</a></li><li><a href="BOOMR.html#event:click">BOOMR#event:click</a></li><li><a href="BOOMR.html#event:config">BOOMR#event:config</a></li><li><a href="BOOMR.html#event:dom_loaded">BOOMR#event:dom_loaded</a></li><li><a href="BOOMR.html#event:error">BOOMR#event:error</a></li><li><a href="BOOMR.html#event:form_submit">BOOMR#event:form_submit</a></li><li><a href="BOOMR.html#event:netinfo">BOOMR#event:netinfo</a></li><li><a href="BOOMR.html#event:page_load_beacon">BOOMR#event:page_load_beacon</a></li><li><a href="BOOMR.html#event:page_ready">BOOMR#event:page_ready</a></li><li><a href="BOOMR.html#event:page_unload">BOOMR#event:page_unload</a></li><li><a href="BOOMR.html#event:prerender_to_visible">BOOMR#event:prerender_to_visible</a></li><li><a href="BOOMR.html#event:rage_click">BOOMR#event:rage_click</a></li><li><a href="BOOMR.html#event:spa_cancel">BOOMR#event:spa_cancel</a></li><li><a href="BOOMR.html#event:spa_init">BOOMR#event:spa_init</a></li><li><a href="BOOMR.html#event:spa_navigation">BOOMR#event:spa_navigation</a></li><li><a href="BOOMR.html#event:visibility_changed">BOOMR#event:visibility_changed</a></li><li><a href="BOOMR.html#event:xhr_error">BOOMR#event:xhr_error</a></li><li><a href="BOOMR.html#event:xhr_init">BOOMR#event:xhr_init</a></li><li><a href="BOOMR.html#event:xhr_load">BOOMR#event:xhr_load</a></li><li><a href="BOOMR.html#event:xhr_send">BOOMR#event:xhr_send</a></li><li><a href="document.html#event:onBeforeBoomerangBeacon">document#event:onBeforeBoomerangBeacon</a></li><li><a href="document.html#event:onBoomerangBeacon">document#event:onBoomerangBeacon</a></li><li><a href="document.html#event:onBoomerangLoaded">document#event:onBoomerangLoaded</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-README.template.html">README.template</a></li><li><a href="tutorial-building.html">Building</a></li><li><a href="tutorial-contributing.html">Contributing</a></li><li><a href="tutorial-creating-plugins.html">Creating Plugins</a></li><li><a href="tutorial-header-snippets.html">Header Snippets</a></li><li><a href="tutorial-howtos.html">How-Tos</a></li><li><a href="tutorial-loader-snippet.html">Non-Blocking Loader Snippet</a></li><li><a href="tutorial-methodology.html">Methodology</a></li><li><a href="tutorial-page-overrides.html">Page Overrides</a></li><li><a href="tutorial-perf-tests.html">Performance Tests</a></li><li><a href="tutorial-tests.html">Tests</a></li><li><a href="tutorial-version-history.html">Version History</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#BOOMR_check_doc_domain">BOOMR_check_doc_domain</a></li><li><a href="global.html#BOOMR_lstart">BOOMR_lstart</a></li><li><a href="global.html#BOOMR_onload">BOOMR_onload</a></li><li><a href="global.html#BOOMR_start">BOOMR_start</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    <h1>Non-Blocking Loader Snippet</h1>
</header>

<article>
    <p>If you are loading boomerang.js separately from your main application bundle, i.e.
from a CDN or a third-party service (such as mPulse), we recommend loading boomerang.js
using the CSP-compliant non-blocking script loader pattern.</p>
<p>The methodology, <a href="http://www.lognormal.com/blog/2012/12/12/the-script-loader-pattern/">developed by Philip Tellis</a>
and others, and further <a href="https://calendar.perfplanet.com/2018/a-csp-compliant-non-blocking-script-loader/">improved in 2018</a>,
ensures Boomerang (or any third-party JavaScript) loads asynchronously
and non-blocking.  This means that the browser will not pause while the JavaScript
is loading, nor will it block the <code>onload</code> event.</p>
<p>The Boomerang Loader Snippet is currently around 210 lines of code (with comments), and minifies to around 2500 bytes.</p>
<p>The snippet does the following:</p>
<ol>
<li>It checks whether or not the snippet has already been run or Boomerang has already
been loaded.  If so, it exits.</li>
<li>It adds a <code>window</code> <code>load</code> event handler, to ensure that Boomerang can measure
the Page Load time in non-NavigationTiming browsers, even if boomerang.js
loads after the <code>load</code> event.</li>
<li>For browsers that <a href="https://caniuse.com/#feat=link-rel-preload">support Preload</a> <code>&lt;link rel=&quot;preload&quot; as=&quot;script&quot;&gt;</code>,
Boomerang will add a <code>&lt;link&gt;</code> node to tell the browser to fetch Boomerang.js.
<ul>
<li>Once the Preload has finished, Boomerang adds a regular <code>&lt;script&gt;</code> node to the page with the same Boomerang URL,
which tells the browser to execute Boomerang.</li>
</ul>
</li>
<li>For browsers that do not support Preload, or if Preload fails or doesn't trigger within the defined timeframe (default 3 seconds),
the non-blocking IFRAME loader method is used.
<ul>
<li>A hidden <code>&lt;iframe&gt;</code> is injected into the page.</li>
<li>The snippet attempts to read the IFRAME's <code>contentWindow.document</code>.  If it can't,
it updates the IFRAME's <code>src</code> to add JavaScript that sets the IFRAME's <code>document.domain</code>
to the current page's <code>document.domain</code>.  This ensures the anonymous IFRAME
can communicate with the host page.</li>
<li>It writes a function <code>_l()</code> to the IFRAME's <code>document</code> which will add a
<code>&lt;script&gt;</code> tag that loads boomerang.js.</li>
<li>It sets the IFRAME's <code>&lt;body onload=&quot;document._l()&quot;&gt;</code> to run the function
above, so the <code>&lt;script&gt;</code> tag is loaded after the IFRAME's <code>onload</code> event has fired.</li>
</ul>
</li>
<li>For IE 6/7/8, a dynamic <code>&lt;script&gt;</code> node is added to the page.
<ul>
<li>IE 6 and 7 don't support the non-blocking IFRAME loader method, due to problems they have with <code>about:blank</code>
URLs in secure contexts.  IE 6 and 7 account for 0.00052% of internet traffic (according to mPulse) in 2021.</li>
<li>IE 8 support would require a <code>document.write()</code> call with the IFRAME loader method, which we want to avoid as
static analysis tools may point it out even if it's only executed in older browsers. IE 8 accounts for 0.00109% of internet traffic (according to mPulse) in 2021.</li>
<li>Note this means that in IE 6, 7 and 8, Boomerang could be a SPOF (Single Point of Failure) if the script is delayed,
potentially delaying the Page Load</li>
</ul>
</li>
</ol>
<p>Note: We split the <code>&lt;body</code> tag insertion into <code>&lt;bo</code> and <code>dy</code> to avoid server-side output filters that may replace <code>&lt;body</code> tags with their own code.</p>
<p>For proof that the non-blocking script loader pattern does not affect page load,
you can look at this
<a href="https://dev.nicj.net/boomerang-audit/test-mpulse-loader-snippet-delayed.html">test case</a>
that delays JavaScript from loading by 5 seconds or these
<a href="https://www.webpagetest.org/result/171221_HD_bb090190517fa8dd101859e8c1f327fe/">WebPagetest results</a>.</p>
<h2>The Snippet</h2>
<p>Here's the snippet:</p>
<pre class="prettyprint source lang-javascript"><code>&lt;script>
(function() {
  // Boomerang Loader Snippet version 15
  if (window.BOOMR &amp;&amp; (window.BOOMR.version || window.BOOMR.snippetExecuted)) {
    return;
  }

  window.BOOMR = window.BOOMR || {};
  window.BOOMR.snippetStart = new Date().getTime();
  window.BOOMR.snippetExecuted = true;
  window.BOOMR.snippetVersion = 15;

  // NOTE: Set Boomerang URL here
  window.BOOMR.url = &quot;&quot;;

  // document.currentScript is supported in all browsers other than IE
  var where = document.currentScript || document.getElementsByTagName(&quot;script&quot;)[0],
      // Parent element of the script we inject
      parentNode = where.parentNode,
      // Whether or not Preload method has worked
      promoted = false,
      // How long to wait for Preload to work before falling back to iframe method
      LOADER_TIMEOUT = 3000;

  // Tells the browser to execute the Preloaded script by adding it to the DOM
  function promote() {
    if (promoted) {
      return;
    }

    var script = document.createElement(&quot;script&quot;);

    script.id = &quot;boomr-scr-as&quot;;
    script.src = window.BOOMR.url;

    // Not really needed since dynamic scripts are async by default and the script is already in cache at this point,
    // but some naive parsers will see a missing async attribute and think we're not async
    script.async = true;

    parentNode.appendChild(script);

    promoted = true;
  }

  // Non-blocking iframe loader (fallback for non-Preload scenarios) for all recent browsers.
  // For IE 6/7/8, falls back to dynamic script node.
  function iframeLoader(wasFallback) {
    promoted = true;

    var dom,
        doc = document,
        bootstrap, iframe, iframeStyle,
        win = window;

    window.BOOMR.snippetMethod = wasFallback ? &quot;if&quot; : &quot;i&quot;;

    // Adds Boomerang within the iframe
    bootstrap = function(parent, scriptId) {
      var script = doc.createElement(&quot;script&quot;);

      script.id = scriptId || &quot;boomr-if-as&quot;;
      script.src = window.BOOMR.url;

      BOOMR_lstart = new Date().getTime();

      parent = parent || doc.body;
      parent.appendChild(script);
    };

    // For IE 6/7/8, we'll just load the script in the current frame:
    // * IE 6/7 don't support 'about:blank' for an iframe src (it triggers warnings on secure sites)
    // * IE 8 required a doc write call for it to work, which is bad practice
    // This means loading on IE 6/7/8 may cause SPoF.
    if (!window.addEventListener &amp;&amp; window.attachEvent &amp;&amp; navigator.userAgent.match(/MSIE [678]\./)) {
      window.BOOMR.snippetMethod = &quot;s&quot;;

      bootstrap(parentNode, &quot;boomr-async&quot;);

      return;
    }

    // The rest of this function is for browsers that don't support Preload hints but will work with CSP &amp; iframes
    iframe = document.createElement(&quot;IFRAME&quot;);

    // An empty frame
    iframe.src = &quot;about:blank&quot;;

    // We set title and role appropriately to play nicely with screen readers and other assistive technologies
    iframe.title = &quot;&quot;;
    iframe.role = &quot;presentation&quot;;

    // Ensure we're not loaded lazily
    iframe.loading = &quot;eager&quot;;

    // Hide the iframe
    iframeStyle = (iframe.frameElement || iframe).style;
    iframeStyle.width = 0;
    iframeStyle.height = 0;
    iframeStyle.border = 0;
    iframeStyle.display = &quot;none&quot;;

    // Append to the end of the current block
    parentNode.appendChild(iframe);

    // Try to get the iframe's document object
    try {
      win = iframe.contentWindow;
      doc = win.document.open();
    }
    catch (e) {
      // document.domain has been changed and we're on an old version of IE, so we got an access denied.
      // Note: the only browsers that have this problem also do not have CSP support.

      // Get document.domain of the parent window
      dom = document.domain;

      // Set the src of the iframe to a JavaScript URL that will immediately set its document.domain
      // to match the parent.
      // This lets us access the iframe document long enough to inject our script.
      // Our script may need to do more domain massaging later.
      iframe.src = &quot;javascript:var d=document.open();d.domain='&quot; + dom + &quot;';void 0;&quot;;
      win = iframe.contentWindow;

      doc = win.document.open();
    }

    // document.domain hasn't changed, regular method should be OK
    win._boomrl = function() {
      bootstrap();
    };

    if (win.addEventListener) {
      win.addEventListener(&quot;load&quot;, win._boomrl, false);
    }
    else if (win.attachEvent) {
      win.attachEvent(&quot;onload&quot;, win._boomrl);
    }

    // Finish the document
    doc.close();
  }

  // See if Preload is supported or not
  var link = document.createElement(&quot;link&quot;);

  if (link.relList &amp;&amp;
      typeof link.relList.supports === &quot;function&quot; &amp;&amp;
      link.relList.supports(&quot;preload&quot;) &amp;&amp;
      (&quot;as&quot; in link)) {
    window.BOOMR.snippetMethod = &quot;p&quot;;

    // Set attributes to trigger a Preload
    link.href = window.BOOMR.url;
    link.rel  = &quot;preload&quot;;
    link.as   = &quot;script&quot;;

    // Add our script tag if successful, fallback to iframe if not
    link.addEventListener(&quot;load&quot;, promote);
    link.addEventListener(&quot;error&quot;, function() {
      iframeLoader(true);
    });

    // Have a fallback in case Preload does nothing or is slow
    setTimeout(function() {
      if (!promoted) {
        iframeLoader(true);
      }
    }, LOADER_TIMEOUT);

    // Note the timestamp we started trying to Preload
    BOOMR_lstart = new Date().getTime();

    // Append our link tag
    parentNode.appendChild(link);
  }
  else {
    // No Preload support, use iframe loader
    iframeLoader(false);
  }

  // Save when the onload event happened, in case this is a non-NavigationTiming browser
  function boomerangSaveLoadTime(e) {
    window.BOOMR_onload = (e &amp;&amp; e.timeStamp) || new Date().getTime();
  }

  if (window.addEventListener) {
    window.addEventListener(&quot;load&quot;, boomerangSaveLoadTime, false);
  }
  else if (window.attachEvent) {
    window.attachEvent(&quot;onload&quot;, boomerangSaveLoadTime);
  }
})();
&lt;/script>
</code></pre>
<p>Minified:</p>
<pre class="prettyprint source lang-javascript"><code>&lt;script>(function(){if(window.BOOMR&amp;&amp;(window.BOOMR.version||window.BOOMR.snippetExecuted)){return}window.BOOMR=window.BOOMR||{};window.BOOMR.snippetStart=(new Date).getTime();window.BOOMR.snippetExecuted=true;window.BOOMR.snippetVersion=15;window.BOOMR.url=&quot;&quot;;var e=document.currentScript||document.getElementsByTagName(&quot;script&quot;)[0],a=e.parentNode,s=false,t=3e3;function n(){if(s){return}var e=document.createElement(&quot;script&quot;);e.id=&quot;boomr-scr-as&quot;;e.src=window.BOOMR.url;e.async=true;a.appendChild(e);s=true}function i(e){s=true;var t,i=document,n,o,d,r=window;window.BOOMR.snippetMethod=e?&quot;if&quot;:&quot;i&quot;;n=function(e,t){var n=i.createElement(&quot;script&quot;);n.id=t||&quot;boomr-if-as&quot;;n.src=window.BOOMR.url;BOOMR_lstart=(new Date).getTime();e=e||i.body;e.appendChild(n)};if(!window.addEventListener&amp;&amp;window.attachEvent&amp;&amp;navigator.userAgent.match(/MSIE [678]\./)){window.BOOMR.snippetMethod=&quot;s&quot;;n(a,&quot;boomr-async&quot;);return}o=document.createElement(&quot;IFRAME&quot;);o.src=&quot;about:blank&quot;;o.title=&quot;&quot;;o.role=&quot;presentation&quot;;o.loading=&quot;eager&quot;;d=(o.frameElement||o).style;d.width=0;d.height=0;d.border=0;d.display=&quot;none&quot;;a.appendChild(o);try{r=o.contentWindow;i=r.document.open()}catch(e){t=document.domain;o.src=&quot;javascript:var d=document.open();d.domain='&quot;+t+&quot;';void 0;&quot;;r=o.contentWindow;i=r.document.open()}r._boomrl=function(){n()};if(r.addEventListener){r.addEventListener(&quot;load&quot;,r._boomrl,false)}else if(r.attachEvent){r.attachEvent(&quot;onload&quot;,r._boomrl)}i.close()}var o=document.createElement(&quot;link&quot;);if(o.relList&amp;&amp;typeof o.relList.supports===&quot;function&quot;&amp;&amp;o.relList.supports(&quot;preload&quot;)&amp;&amp;&quot;as&quot;in o){window.BOOMR.snippetMethod=&quot;p&quot;;o.href=window.BOOMR.url;o.rel=&quot;preload&quot;;o.as=&quot;script&quot;;o.addEventListener(&quot;load&quot;,n);o.addEventListener(&quot;error&quot;,function(){i(true)});setTimeout(function(){if(!s){i(true)}},t);BOOMR_lstart=(new Date).getTime();a.appendChild(o)}else{i(false)}function d(e){window.BOOMR_onload=e&amp;&amp;e.timeStamp||(new Date).getTime()}if(window.addEventListener){window.addEventListener(&quot;load&quot;,d,false)}else if(window.attachEvent){window.attachEvent(&quot;onload&quot;,d)}})();&lt;/script>
</code></pre>
<h2>Delaying the Snippet</h2>
<p>You may want to delay loading Boomerang until after the <code>onload</code> event.  This would
ensure that no Boomerang code is executed in the critical-path of the page load.</p>
<p>The main downside to doing this is that you are more likely to lose beacons
from some users.  The longer it takes Boomerang to load on the page, the higher
chance that the user will have navigated away, or closed the browser, before
boomerang.js is loaded.</p>
<p>Here is a modification of the Boomerang Loader Snippet to delay until after
<code>onload</code>:</p>
<pre class="prettyprint source lang-javascript"><code>&lt;script>
(function() {
  // Boomerang Loader Snippet version 15
  if (window.BOOMR &amp;&amp; (window.BOOMR.version || window.BOOMR.snippetExecuted)) {
    return;
  }

  window.BOOMR = window.BOOMR || {};
  window.BOOMR.snippetStart = new Date().getTime();
  window.BOOMR.snippetExecuted = true;
  window.BOOMR.snippetVersion = 15;

  // NOTE: Set Boomerang URL here
  window.BOOMR.url = &quot;&quot;;

  // document.currentScript is supported in all browsers other than IE
  var where = document.currentScript || document.getElementsByTagName(&quot;script&quot;)[0],
      // Parent element of the script we inject
      parentNode = where.parentNode,
      // Whether or not Preload method has worked
      promoted = false,
      // How long to wait for Preload to work before falling back to iframe method
      LOADER_TIMEOUT = 3000;

  // Tells the browser to execute the Preloaded script by adding it to the DOM
  function promote() {
    if (promoted) {
      return;
    }

    var script = document.createElement(&quot;script&quot;);

    script.id = &quot;boomr-scr-as&quot;;
    script.src = window.BOOMR.url;

    // Not really needed since dynamic scripts are async by default and the script is already in cache at this point,
    // but some naive parsers will see a missing async attribute and think we're not async
    script.async = true;

    parentNode.appendChild(script);

    promoted = true;
  }

  // Non-blocking iframe loader (fallback for non-Preload scenarios) for all recent browsers.
  // For IE 6/7/8, falls back to dynamic script node.
  function iframeLoader(wasFallback) {
    promoted = true;

    var dom,
        doc = document,
        bootstrap, iframe, iframeStyle,
        win = window;

    window.BOOMR.snippetMethod = wasFallback ? &quot;if&quot; : &quot;i&quot;;

    // Adds Boomerang within the iframe
    bootstrap = function(parent, scriptId) {
      var script = doc.createElement(&quot;script&quot;);

      script.id = scriptId || &quot;boomr-if-as&quot;;
      script.src = window.BOOMR.url;

      BOOMR_lstart = new Date().getTime();

      parent = parent || doc.body;
      parent.appendChild(script);
    };

    // For IE 6/7/8, we'll just load the script in the current frame:
    // * IE 6/7 don't support 'about:blank' for an iframe src (it triggers warnings on secure sites)
    // * IE 8 required a doc write call for it to work, which is bad practice
    // This means loading on IE 6/7/8 may cause SPoF.
    if (!window.addEventListener &amp;&amp; window.attachEvent &amp;&amp; navigator.userAgent.match(/MSIE [678]\./)) {
      window.BOOMR.snippetMethod = &quot;s&quot;;

      bootstrap(parentNode, &quot;boomr-async&quot;);

      return;
    }

    // The rest of this function is for browsers that don't support Preload hints but will work with CSP &amp; iframes
    iframe = document.createElement(&quot;IFRAME&quot;);

    // An empty frame
    iframe.src = &quot;about:blank&quot;;

    // We set title and role appropriately to play nicely with screen readers and other assistive technologies
    iframe.title = &quot;&quot;;
    iframe.role = &quot;presentation&quot;;

    // Ensure we're not loaded lazily
    iframe.loading = &quot;eager&quot;;

    // Hide the iframe
    iframeStyle = (iframe.frameElement || iframe).style;
    iframeStyle.width = 0;
    iframeStyle.height = 0;
    iframeStyle.border = 0;
    iframeStyle.display = &quot;none&quot;;

    // Append to the end of the current block
    parentNode.appendChild(iframe);

    // Try to get the iframe's document object
    try {
      win = iframe.contentWindow;
      doc = win.document.open();
    }
    catch (e) {
      // document.domain has been changed and we're on an old version of IE, so we got an access denied.
      // Note: the only browsers that have this problem also do not have CSP support.

      // Get document.domain of the parent window
      dom = document.domain;

      // Set the src of the iframe to a JavaScript URL that will immediately set its document.domain
      // to match the parent.
      // This lets us access the iframe document long enough to inject our script.
      // Our script may need to do more domain massaging later.
      iframe.src = &quot;javascript:var d=document.open();d.domain='&quot; + dom + &quot;';void 0;&quot;;
      win = iframe.contentWindow;

      doc = win.document.open();
    }

    // document.domain hasn't changed, regular method should be OK
    win._boomrl = function() {
      bootstrap();
    };

    if (win.addEventListener) {
      win.addEventListener(&quot;load&quot;, win._boomrl, false);
    }
    else if (win.attachEvent) {
      win.attachEvent(&quot;onload&quot;, win._boomrl);
    }

    // Finish the document
    doc.close();
  }

  function boomerangLoad() {
    // See if Preload is supported or not
    var link = document.createElement(&quot;link&quot;);

    if (link.relList &amp;&amp;
        typeof link.relList.supports === &quot;function&quot; &amp;&amp;
        link.relList.supports(&quot;preload&quot;) &amp;&amp;
        (&quot;as&quot; in link)) {
      window.BOOMR.snippetMethod = &quot;p&quot;;

      // Set attributes to trigger a Preload
      link.href = window.BOOMR.url;
      link.rel  = &quot;preload&quot;;
      link.as   = &quot;script&quot;;

      // Add our script tag if successful, fallback to iframe if not
      link.addEventListener(&quot;load&quot;, promote);
      link.addEventListener(&quot;error&quot;, function() {
        iframeLoader(true);
      });

      // Have a fallback in case Preload does nothing or is slow
      setTimeout(function() {
        if (!promoted) {
          iframeLoader(true);
        }
      }, LOADER_TIMEOUT);

      // Note the timestamp we started trying to Preload
      BOOMR_lstart = new Date().getTime();

      // Append our link tag
      parentNode.appendChild(link);
    }
    else {
      // No Preload support, use iframe loader
      iframeLoader(false);
    }
  }

  // Save when the onload event happened, in case this is a non-NavigationTiming browser
  function boomerangSaveLoadTime(e) {
    window.BOOMR_onload = (e &amp;&amp; e.timeStamp) || new Date().getTime();
  }

  if (window.addEventListener) {
    window.addEventListener(&quot;load&quot;, boomerangSaveLoadTime, false);
  }
  else if (window.attachEvent) {
    window.attachEvent(&quot;onload&quot;, boomerangSaveLoadTime);
  }

  // Run at onload
  function windowOnLoad(e) {
    boomerangSaveLoadTime(e);
    setTimeout(boomerangLoad, 0);
  }

  // If we think the load event has already fired, load Boomerang now
  if ((&quot;performance&quot; in win &amp;&amp; win.performance &amp;&amp; win.performance.timing &amp;&amp; win.performance.timing.loadEventStart) ||
    (document.readyState === &quot;complete&quot;)) {
    boomerangLoad();
  }
  else {
    // Wait until onload
    if (win.addEventListener) {
      win.addEventListener(&quot;load&quot;, windowOnLoad, false);
    }
    else if (win.attachEvent) {
      win.attachEvent(&quot;onload&quot;, windowOnLoad);
    }
  }
})();
&lt;/script>
</code></pre>
<p>Minified:</p>
<pre class="prettyprint source lang-javascript"><code>&lt;script>(function(){if(window.BOOMR&amp;&amp;(window.BOOMR.version||window.BOOMR.snippetExecuted)){return}window.BOOMR=window.BOOMR||{};window.BOOMR.snippetStart=(new Date).getTime();window.BOOMR.snippetExecuted=true;window.BOOMR.snippetVersion=15;window.BOOMR.url=&quot;&quot;;var e=document.currentScript||document.getElementsByTagName(&quot;script&quot;)[0],r=e.parentNode,s=false,n=3e3;function t(){if(s){return}var e=document.createElement(&quot;script&quot;);e.id=&quot;boomr-scr-as&quot;;e.src=window.BOOMR.url;e.async=true;r.appendChild(e);s=true}function i(e){s=true;var n,i=document,t,o,a,d=window;window.BOOMR.snippetMethod=e?&quot;if&quot;:&quot;i&quot;;t=function(e,n){var t=i.createElement(&quot;script&quot;);t.id=n||&quot;boomr-if-as&quot;;t.src=window.BOOMR.url;BOOMR_lstart=(new Date).getTime();e=e||i.body;e.appendChild(t)};if(!window.addEventListener&amp;&amp;window.attachEvent&amp;&amp;navigator.userAgent.match(/MSIE [678]\./)){window.BOOMR.snippetMethod=&quot;s&quot;;t(r,&quot;boomr-async&quot;);return}o=document.createElement(&quot;IFRAME&quot;);o.src=&quot;about:blank&quot;;o.title=&quot;&quot;;o.role=&quot;presentation&quot;;o.loading=&quot;eager&quot;;a=(o.frameElement||o).style;a.width=0;a.height=0;a.border=0;a.display=&quot;none&quot;;r.appendChild(o);try{d=o.contentWindow;i=d.document.open()}catch(e){n=document.domain;o.src=&quot;javascript:var d=document.open();d.domain='&quot;+n+&quot;';void 0;&quot;;d=o.contentWindow;i=d.document.open()}d._boomrl=function(){t()};if(d.addEventListener){d.addEventListener(&quot;load&quot;,d._boomrl,false)}else if(d.attachEvent){d.attachEvent(&quot;onload&quot;,d._boomrl)}i.close()}function o(){var e=document.createElement(&quot;link&quot;);if(e.relList&amp;&amp;typeof e.relList.supports===&quot;function&quot;&amp;&amp;e.relList.supports(&quot;preload&quot;)&amp;&amp;&quot;as&quot;in e){window.BOOMR.snippetMethod=&quot;p&quot;;e.href=window.BOOMR.url;e.rel=&quot;preload&quot;;e.as=&quot;script&quot;;e.addEventListener(&quot;load&quot;,t);e.addEventListener(&quot;error&quot;,function(){i(true)});setTimeout(function(){if(!s){i(true)}},n);BOOMR_lstart=(new Date).getTime();r.appendChild(e)}else{i(false)}}function a(e){window.BOOMR_onload=e&amp;&amp;e.timeStamp||(new Date).getTime()}if(window.addEventListener){window.addEventListener(&quot;load&quot;,a,false)}else if(window.attachEvent){window.attachEvent(&quot;onload&quot;,a)}function d(e){a(e);setTimeout(o,0)}if(&quot;performance&quot;in win&amp;&amp;win.performance&amp;&amp;win.performance.timing&amp;&amp;win.performance.timing.loadEventStart||document.readyState===&quot;complete&quot;){o()}else{if(win.addEventListener){win.addEventListener(&quot;load&quot;,d,false)}else if(win.attachEvent){win.attachEvent(&quot;onload&quot;,d)}}})();&lt;/script>
</code></pre>
<h2>Known Issues</h2>
<ul>
<li>
<p>Websites using Google Tag Manager (GTM) to inject the Loader Snippet may not see beacons from Firefox &lt;= 74</p>
<ul>
<li>These versions of Firefox do not support Preload, so fallback to using the IFRAME loader</li>
<li>boomerang.js is not fetched due to a Firefox bug with setting the <code>iframe.src = &quot;about:blank&quot;</code>, which is done for Content Security Policies (CSP) compatibility</li>
<li>Websites that are not using Content Security Policies can change:</li>
</ul>
<pre class="prettyprint source lang-javascript"><code>// An empty frame
iframe.src = &quot;about:blank&quot;;
</code></pre>
<p>to</p>
<pre class="prettyprint source lang-javascript"><code>// An empty frame
iframe.src = &quot;javascript:void(0)&quot;;
</code></pre>
<ul>
<li>Websites that are using Content Security Policies should use a <code>&lt;script async&gt;</code> tag to load boomerang.js instead of the Loader Snippet</li>
</ul>
</li>
</ul>
</article>



</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	© 2010-2024 the contributors to the Open Source Boomerang project and Akamai Technologies, Inc.
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a>
	
		on Tue Feb 6th 2024
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>