<%= header %>
<!--
	Tests xhr:subresource
-->
<%= boomerangScript %>
<script src="19-xhrs-as-subresources.js" type="text/javascript"></script>
<script>
var t = BOOMR_test;

(function(w, d) {
	w.addEventListener("load", function() {
		function hookBoomerang() {
			if (window.BOOMR && BOOMR.version) {
				if (BOOMR.plugins && BOOMR.plugins.AutoXHR) {
					setTimeout(function() {
						var xhr1 = new XMLHttpRequest();
						xhr1.open("GET", "/delay?id=1&delay=5000&file=/pages/04-page-params/support/img.jpg&rnd=" + Math.random());
						xhr1.send(null);

						setTimeout(function() {
							var xhr2 = new XMLHttpRequest();
							xhr2.open("GET", "/delay?id=2&delay=5000&file=/pages/04-page-params/support/img.jpg&rnd=" + Math.random());
							xhr2.send(null);
						}, 1000);

						if (t.isFetchApiSupported()) {
							setTimeout(function() {
								var f1 = fetch("/delay?id=1&delay=500&file=/pages/04-page-params/support/img.jpg&rnd=" + Math.random());
								f1.then(function(response) { response.text(); });
							}, 2000);
							setTimeout(function() {
								var f2 = fetch("/delay?id=2&delay=500&file=/pages/04-page-params/support/img.jpg&rnd=" + Math.random());
								f2.then(function(response) { response.text(); });
							}, 3000);
						}
					}, 1000);
				}
				return true;
			}
		}

		if (!hookBoomerang()) {
			if (document.addEventListener) {
				document.addEventListener("onBoomerangLoaded", hookBoomerang);
			}
			else if (document.attachEvent) {
				document.attachEvent("onpropertychange", function(e) {
					e = e || window.event;
					if (e && e.propertyName === "onBoomerangLoaded") {
						hookBoomerang();
					}
				});
			}
		}
	});
}(this, this.document));
</script>

<script type="text/javascript">
BOOMR_test.init({
	testAfterOnBeacon: BOOMR.plugins.AutoXHR ? (t.isFetchApiSupported() ? 5 : 3) : 1,
	AutoXHR: {
		alwaysSendXhr: true,
		monitorFetch: true
	},
	PageParams: {
		xhr: "subresource",
		pageGroups: [
			{
				type: "Regexp",
				parameter1: ".*/19-xhrs-as-subresources.html",
				parameter2: "Test Page",
				on: ["navigation"]
			},
			{
				type: "Regexp",
				parameter1: ".*id=2.*",
				parameter2: "Test Page",
				on: ["xhr"]
			}
		]
	},
	instrument_xhr: true
});
</script>
<%= footer %>
