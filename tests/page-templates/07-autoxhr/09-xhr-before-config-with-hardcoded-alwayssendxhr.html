<%= header %>
<script src="09-xhr-before-config-with-hardcoded-alwayssendxhr.js" type="text/javascript"></script>
<!-- the snippet is on the page -->
<%= instrumentXHRSnippet %>
<script>
// and we've BOOMR_config'd alwaysSendXhr
window.BOOMR_config = {
	AutoXHR: {
		alwaysSendXhr: true
	},
	instrument_xhr: true
};
</script>
<!-- boomerang will load in 3 seconds, giving enough time for the first XHR to complete -->
<%= boomerangDelayedSnippet %>
<script>
var xhr;

//opened and completed before config
xhr = new XMLHttpRequest();
xhr.open("GET", "/delay?delay=0&file=build/boomerang-latest-debug.js&xhr1", true);
xhr.addEventListener(
	"readystatechange",
	function() {
		if (xhr.readyState === 4) {
			// opened before config, completed after config
			xhr = new XMLHttpRequest();
			xhr.open("GET", "/delay?delay=8000&file=build/boomerang-latest-debug.js&xhr2", true);
			xhr.send(null);

			// wait another 5 seconds to load config
			setTimeout(function() {
				// The BOOMR_test only sees 3 of the 4 beacons
				BOOMR_test.init({
					testAfterOnBeacon: window.XMLHttpRequest && (new XMLHttpRequest()).addEventListener ? 3 : 1,
					AutoXHR: {
						alwaysSendXhr: true
					},
					ResourceTiming: {
						enabled: true
					},
					instrument_xhr: true,
					onBoomerangLoaded: function() {
						//opened and completed after config
						setTimeout(function() {
							xhr = new XMLHttpRequest();
							xhr.open("GET", "/delay?delay=0&file=build/boomerang-latest-debug.js&xhr3", true);
							xhr.send(null);
						}, 3000);
					},
					PageParams: {
						pageGroups: [
							{
								type: "Regexp",
								parameter1: "xhr1",
								parameter2: "XHR1"
							},
							{
								type: "Regexp",
								parameter1: "xhr2",
								parameter2: "XHR2"
							},
							{
								type: "Regexp",
								parameter1: "xhr3",
								parameter2: "XHR3"
							}
						]
					}
				});
			}, 5000);
		}
	},
	false);
xhr.send(null);
</script>
<%= footer %>
