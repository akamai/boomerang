<!DOCTYPE HTML>
<html>
<head>
<title>Single Page Application Plugin APIs</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../boomerang-docs.css">
</head>
<body>
<span style="float:right;"><a href="../">All Docs</a> | <a href="index.html">Index</a></span>
<h1>Single Page Application Plugin APIs</h1>

<p>
  <strong>Note:</strong> These plugins require the <code>AutoXHR</code>
  Plugin to be included in your build of Boomerang.
</p>

<p>
  The Single Page Application (SPA) Plugins are designed to support Boomerang
  in cases where SPAs are used on the page and therefore the page's
  <code>onload</code> event doesn't matter. In those cases Boomerang will
  send Beacons when a <code>route change</code> event appears.
</p>
<p>
  Between the start and end of the route changes Boomerang will monitor the
  <code>DOM</code> for <code>MutationObserver</code> events and <code>XHR</code>
  requests. If those happen we will automatically assume that they are relevant
  to the <code>route change</code> event
</p>

<p>
  <strong>Note:</strong> It is advised to not provide support for multiple
  SPA-Plugins from the same boomerang Build.
</p>

<p>The code and examples described here-in apply for the following
  frameworks:</p>
<ul>
  <li><a href="#angular">Angular</a></li>
<!--   <li><a href="#backbone">Backbone</a></li>  -->
  <li><a href="#ember">Ember</a></li>
</ul>

<h2 id="initConfig"><code>init()</code> Configuration</h2>

<p>
  Each plugin requires to be either enabled or disabled in the <code>init()</code>
  function of BoomerangJS.</p>

<dl class="api">
  <dt>init(oConfig)</dt>
  <dd>
    <p>
      Called by the <a href="BOOMR.html#init">BOOMR.init()</a> method to configure the
      SPA plugin. Per SPA there is only one configurable option:
    </p>
    <dl>
      <dt>enabled</dt>
      <dd>
	<strong>[required]</strong>
	Set this to true <strong>only</strong> for the SPA you wish to work with in your project or application.
      </dd>
    </dl>
<pre>BOOMR.init({
	<i>&lt;!-- Angular --></i>
	<em>Angular: {							</em>
	<em>			enabled: true				</em>
	<em>}								</em>
	<i>&lt;!-- Ember --></i>
	<em>Ember: {							</em>
	<em>			enabled: true				</em>
	<em>},								</em>
	<em>autorun: false						</em>
});</pre>
<p><strong>NOTE:</strong>
  It is advisable to tell Boomerang not to start automatically by setting the
  <code>autorun</code> flag to <code>false</code>.
</p>
  </dd>
</dl>

<dl class="api">
  <dt>is_complete()</dt>
  <dd>
    <p>This should always return <code>true</code> as <code>EventListener</code>s
      for <code>MutationObserver</code> and <code>route change</code> will trigger
      independent to the <code>onLoad</code> event.</p>
  </dd>
</dl>

<dl class="api">
  <dt>hook()</dt>
  <dd>
    <p>Hook specific to the SPA. Please refer to the SPA-Framework specific documentation
      below on which parameters to fill this with</p>
  </dd>
</dl>

<h2 id="angular"><code>Angular</code> Configuration</h2>

<p>
  For AngularJS it is necessairy to hook Boomerang into the application
  from the <code>run</code> Callback.
</p>

<p>In your Angular Application or module add this to the <code>run()</code> callback:</p>

<pre><code>var hadRouteChange = false;
$rootScope.$on("$routeChangeStart", function() {
  hadRouteChange = true;
});
function hookAngularBoomerang() {
  if (window.BOOMR && BOOMR.version) {
    if (BOOMR.plugins && BOOMR.plugins.Angular) {
      BOOMR.plugins.Angular.hook($rootScope, hadRouteChange);
    }
    return true;
  }
}

if (!hookAngularBoomerang()) {
  if (document.addEventListener) {
    document.addEventListener("onBoomerangLoaded", hookAngularBoomerang);
  } else if (document.attachEvent) {
    document.attachEvent("onpropertychange", function(e) {
      e = e || window.event;
      if (e && e.propertyName === "onBoomerangLoaded") {
        hookAngularBoomerang();
      }
    });
  }
}
</code></pre>

<p>This makes sure that the following cases covered:</p>
<ol>
  <li><strong>(optimal)</strong> Boomerang loads on time and can hook into the application
    before the first <code>routechange</code> has happend</li>
  <li><strong>(less optimal)</strong> Boomerang loads late and we're going to hook after the
    first <code>routechange</code> has happend and we're going to hook in at
    that point.
  </li>
</ol>

<p>
  Internally the Angular plugin will hook into the <code>$routeChangeStart</code>
  event and set timers for when the request for the route change started. After
  that -- once the <code>routeChange</code> has happend the
  <code>MutationObserver</code> that has been set up will realize that
  everything has been loaded, give itself another second to make sure it hasn't
  missed any final changes and then send a beacon out.
</p>

<h2 id="ember"><code>Ember</code> Configuration</h2>

<p>
  To make Ember work with Boomerang it is necessairy to pass the Application
  itself to the Boomerang plugin.
</p>

<p>In your Ember Application add this to the <code>route()</code> callback:</p>

<pre><code>function hookEmberBoomerang() {
  if (window.BOOMR && BOOMR.version) {
    if (BOOMR.plugins && BOOMR.plugins.Ember) {
      BOOMR.plugins.Ember.hook(App);
    }
    return true;
  }
}

if (!hookEmberBoomerang()) {
  if (document.addEventListener) {
    document.addEventListener("onBoomerangLoaded", hookEmberBoomerang);
  }
  else if (document.attachEvent) {
    document.attachEvent("onpropertychange", function(e) {
      e = e || window.event;
      if (e && e.propertyName === "onBoomerangLoaded") {
        hookEmberBoomerang();
      }
    });
  }
}</code></pre>

<p>Just like the Angular SPA plugin we intend to hook into the application
  as early as possible. However the difference here lies in the point we
  hook into. The Ember plugins <code>hook()</code> function will either
  <code>reopen</code> the already set <code>ApplicationRoute</code> or set
  the Ember applications <code>ApplicationRoute</code> by
  <code>extend()</code>ing the <code>Ember.Route</code> Class.
  We will hook into the applications <code>activate</code> function and
  <code>willTransition</code> event.
</p>

</body>
</html>
<!--
    Copyright (c) 2015, SOASTA Inc.  All rights reserved.
    Copyrights licensed under the BSD License. See the accompanying LICENSE.txt file for terms.
-->
